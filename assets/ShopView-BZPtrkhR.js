import{h as l,H as te,a5 as n,ac as z,a7 as r,n as e,ad as t,v as s,u as M,V as d,a6 as w,af as S,Z as D,F as W,ae as Y,a2 as le,a0 as oe,P as se,Q as ne,ah as re}from"./vue-core-CsbKmrRr.js";import{_ as ie,s as ue}from"./TabList-C060IOAN.js";import{a as Z}from"./index-BFZgDbVB.js";import{_ as ee}from"./PromptDialog-TYGxE2y4.js";import{f as J,_ as ce,C as de}from"./ChangePassword-A46jLZbz.js";import{i as me,e as ve}from"./date-DE_Uv9Lq.js";import{_ as fe}from"./index-DIOy7dA3.js";import"./vuetify-CHkSyw28.js";const _e={id:"parkingDeduction",class:"h-100"},pe={class:"ml-3 text-subtitle-1 font-weight-bold text-grey-darken-3"},ge={class:"flex-grow-1 overflow-hidden overflow-y-auto"},he={class:"d-flex justify-center my-8"},be={key:0},ye={key:1,class:"text-h3"},xe={class:"py-2 text-h6 font-weight-bold"},we={class:"my-1"},ke={class:"text-h3 font-weight-bold"},Ce={class:"my-4 text-h6"},$e={class:"ma-4 d-flex align-center justify-space-around w-100"},Ie={class:"mt-3 d-flex flex-wrap justify-center w-100"},Ve={__name:"ParkingDeduction",props:{activeTab:{type:Object,default:()=>({})},memberInfo:{type:Object,default:()=>({})}},emits:["closeForm"],setup(E,{emit:H}){const B=E,$=H,v="https://peterhsj.github.io/RentalDemo",i=l(!1),I=l(""),h=l(""),V=l(!1),U=l(!1),j=l(!1),b=l(),T=l({license_plate:""}),f=l({}),N=l([]),L=l({carRules:[m=>!!m||"車號為必填"]}),_=l({}),O=l([]),u=l(null),a=async()=>{const m={id:B.memberInfo.vendorId};U.value=!0;const o="/member/grand_hotel/get_store?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const x=await Z.post(o,m),{returnCode:F,message:g,data:P}=x;F===0?(_.value=P[0],O.value=P[0].slipHour.split(",").map(c=>Number(c))):(I.value="訊息通知",h.value=`${g}`,V.value=!1,i.value=!0)}catch(x){console.log({err:x})}finally{U.value=!1}};te(async()=>{await a()}),l([]);const p=async()=>{const{valid:m}=await b.value.validate();if(!m)return;const{license_plate:o}=T.value,x={license_plate:o};U.value=!0;const F="/member/grand_hotel/car_in_park_sel?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const g=await Z.post(F,x),{returnCode:P,message:c,data:Q,discount:G}=g;P===0?(f.value=Q,N.value=G,j.value=Q.ischeck===0):(I.value="訊息通知",h.value=`${c}`,V.value=!1,i.value=!0)}catch(g){console.log({err:g})}finally{U.value=!1}},A=m=>{u.value=m},k=async()=>{if(!u.value){I.value="訊息通知",h.value="請選擇折抵時數",V.value=!1,i.value=!0;return}const m={vendorId:_.value.vendorId,store_type:_.value.store_type,license_plate:T.value.license_plate,count:u.value};U.value=!0;const o="/member/grand_hotel/register_store?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const x=await Z.post(o,m),{returnCode:F,message:g,data:P}=x;F===0?(await a(),b.value.reset(),f.value={},N.value=[],u.value=null,j.value=!1,I.value="訊息通知",h.value=`${g}`,V.value=!1,i.value=!0):(I.value="訊息通知",h.value=`${g}`,V.value=!1,i.value=!0)}catch(x){console.log({err:x})}finally{U.value=!1}},R=()=>{$("closeForm")},y=()=>{i.value=!1,delParkingConfirm()},q=()=>{i.value=!1};return(m,o)=>{const x=n("v-icon"),F=n("v-avatar"),g=n("v-btn"),P=n("v-text-field"),c=n("v-col"),Q=n("v-row"),G=n("v-form"),X=n("v-card"),ae=n("v-container");return r(),z("div",_e,[e(X,{variant:"outlined",class:"rounded-lg bordered border-md bg-white h-100"},{default:t(()=>[s("div",{class:"px-4 py-3 d-flex align-center rental__header bg-orange-lighten-5",onClick:R},[e(x,{icon:"fa:fas fa-chevron-left",size:"20",color:"grey-darken-1",class:"mr-2"}),e(F,{image:`${M(v)}/images/profile.svg`,size:"30"},null,8,["image"]),s("span",pe,d(B.memberInfo.vendor_name)+" [ "+d(B.memberInfo.acc_name)+" ] ",1)]),e(ae,{class:"pb-2 d-flex flex-column",style:{height:"calc(100% - 64px)"}},{default:t(()=>[s("div",ge,[s("div",he,[e(F,{color:"blue-darken-3",size:"170"},{default:t(()=>[_.value.remainPoints==="-1"?(r(),z("span",be,[e(x,{icon:"fa:fas fa-infinity",size:"80",class:""})])):(r(),z("span",ye,d(_.value.remainPoints),1))]),_:1})]),e(G,{ref_key:"formRef",ref:b},{default:t(()=>[e(Q,{dense:""},{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(P,{modelValue:T.value.license_plate,"onUpdate:modelValue":o[0]||(o[0]=C=>T.value.license_plate=C),rules:L.value.carRules,placeholder:"請輸入車號",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",class:"pr-0","bg-color":"white",onInput:o[1]||(o[1]=C=>T.value.license_plate=T.value.license_plate.toUpperCase()),required:""},{"append-inner":t(()=>[e(g,{type:"button",color:"blue-darken-3",variant:"flat",class:"mr-n3 px-3",height:"40",onClick:p},{default:t(()=>[...o[4]||(o[4]=[D(" 查詢 ",-1)])]),_:1})]),_:1},8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512),f.value&&f.value.license_plate?(r(),w(X,{key:0,variant:"flat",class:"pa-2 rounded-lg bg-blue-darken-3 text-center"},{default:t(()=>[o[5]||(o[5]=s("p",null,"入場資訊",-1)),s("p",xe,d(f.value.license_plate),1),s("p",null,d(f.value.arrival_time),1)]),_:1})):S("",!0),f.value&&f.value.license_plate?(r(),w(X,{key:1,variant:"outlined",class:"mt-5 pa-2 d-flex flex-column align-center rounded-lg bordered border-md bg-white"},{default:t(()=>[o[10]||(o[10]=s("p",{class:"my-4 text-h6"},"應繳金額",-1)),s("p",we,[o[6]||(o[6]=s("span",{class:"mr-1"},"NT$",-1)),s("span",ke,d(f.value.paymentAmount),1)]),s("p",Ce,d(_.value.slipStyle===20?"當次折抵":"折抵時數"),1),s("div",$e,[_.value.slipStyle===18||_.value.slipStyle===19?(r(!0),z(W,{key:0},Y(O.value,(C,K)=>(r(),w(g,{key:K,type:"button",color:u.value===C?"blue-lighten-1":"blue-darken-3",variant:"flat",class:"my-2 mx-1 px-4 text-none rounded-pill",height:"40",disabled:!j.value||_.value.remainPoints<1,onClick:qe=>A(C)},{default:t(()=>[D(d(C)+" hr ",1)]),_:2},1032,["color","disabled","onClick"]))),128)):S("",!0),_.value.slipStyle===19||_.value.slipStyle===20?(r(),w(g,{key:1,type:"button",color:u.value===24?"blue-lighten-1":"blue-darken-3",variant:"flat",class:"my-2 mx-1 px-4 text-none rounded-pill",height:"40",disabled:!j.value,onClick:o[2]||(o[2]=C=>A(24))},{default:t(()=>[...o[7]||(o[7]=[D(" 24 hr ",-1)])]),_:1},8,["color","disabled"])):S("",!0)]),s("div",Ie,[j.value||_.value.remainPoints>0?(r(),w(g,{key:0,color:"red-darken-1",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40",onClick:k},{default:t(()=>[...o[8]||(o[8]=[D(" 折抵 ",-1)])]),_:1})):(r(),w(g,{key:1,color:"blue-darken-3",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40",onClick:R},{default:t(()=>[...o[9]||(o[9]=[D(" 回上一頁 ",-1)])]),_:1}))]),N.value.length>0?(r(),w(X,{key:0,variant:"flat",class:"my-2 pa-3 rounded-lg bg-grey-lighten-4 w-100"},{default:t(()=>[e(Q,{dense:""},{default:t(()=>[(r(!0),z(W,null,Y(N.value,(C,K)=>(r(),z(W,{key:K},[e(c,{cols:"8",class:"text-grey-darken-1"},{default:t(()=>[D(d(C.vendor_name),1)]),_:2},1024),e(c,{cols:"4",class:"text-grey-darken-1"},{default:t(()=>[D(d(C.amount)+" "+d(C.store_type===1||C.store_type===5?"hr":"NT$"),1)]),_:2},1024)],64))),128))]),_:1})]),_:1})):S("",!0)]),_:1})):S("",!0)])]),_:1})]),_:1}),e(ee,{modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=C=>i.value=C),message:h.value,messageTitle:I.value,isConfirmBtn:V.value,onPromptConfirm:y,onOnClose:q},null,8,["modelValue","message","messageTitle","isConfirmBtn"])])}}},Te={id:"checkin",class:"h-100"},De={class:"ml-3 text-subtitle-1 font-weight-bold text-grey-darken-3"},Se={class:"d-flex justify-end w-100"},Ue={class:"w-25 w-sm-auto text-center"},Re={class:"mt-3 ga-2 d-flex justify-md-end flex-nowrap"},Be={class:"d-flex justify-space-between w-100"},je={class:"pl-4 pt-2 mt-2 mr-1 rounded-te-xl bg-blue-darken-3 text-subtitle-1",style:{height:"40px"}},Fe={class:"d-flex flex-column flex-md-row flex-lg-row justify-start",style:{"line-height":"1.4"}},Pe={class:"text-body-2 text-no-wrap w-100 w-md-50"},ze={class:"text-body-2 text-no-wrap w-100 w-md-50"},Ne={__name:"SearchForm",props:{activeTab:{type:Object,default:()=>({})},memberInfo:{type:Object,default:()=>({})}},emits:["closeForm"],setup(E,{emit:H}){const B=E,$=H,v="https://peterhsj.github.io/RentalDemo",i=l(!1),I=l(""),h=l(""),V=l(!1),U=l(!1),j=l(),b=l({start_time:"",end_time:""}),T=l({startDateRule:[u=>!!u||"請選擇起始日期",u=>{if(!u||!b.value.end_time)return!0;const a=new Date(u),p=new Date(b.value.end_time);return!a||!p?!0:!ve(a,p)||"起始日期不能晚於結束日期"}],endDateRule:[u=>!!u||"請選擇結束日期",u=>{if(!u||!b.value.start_time)return!0;const a=new Date(b.value.start_time),p=new Date(u);return!a||!p?!0:!me(p,a)||"結束日期不能早於起始日期"}]}),f=l([]),N=async()=>{const{valid:u}=await j.value.validate();if(!u)return;const{start_time:a,end_time:p}=b.value,A={vendorId:B.memberInfo.vendorId,start_time:J(a),end_time:J(p)};U.value=!0;const k="/member/grand_hotel/select_store?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const R=await Z.post(k,A),{returnCode:y,message:q,data:m}=R;if(y===0){if(console.log("data",m),m.length===0){I.value="訊息通知",h.value="查無折抵記錄，請更改查詢條件後再試。",V.value=!1,i.value=!0,f.value=[];return}f.value=m}else I.value="訊息通知",h.value=`${q}`,V.value=!1,i.value=!0}catch(R){console.log({err:R})}finally{U.value=!1}},L=()=>{$("closeForm")},_=()=>{i.value=!1},O=()=>{i.value=!1};return(u,a)=>{const p=n("v-icon"),A=n("v-avatar"),k=n("v-col"),R=n("v-date-input"),y=n("v-btn"),q=n("v-img"),m=n("v-row"),o=n("v-form"),x=n("v-container"),F=n("v-list-item"),g=n("v-list"),P=n("v-card");return r(),z("div",Te,[e(P,{variant:"outlined",class:"rounded-lg bordered border-md bg-white h-100"},{default:t(()=>[s("div",{class:"px-4 py-3 d-flex align-center rental__header bg-orange-lighten-5",onClick:L},[e(p,{icon:"fa:fas fa-chevron-left",size:"20",color:"grey-darken-1",class:"mr-2"}),e(A,{image:`${M(v)}/images/profile.svg`,size:"30"},null,8,["image"]),s("span",De,d(B.memberInfo.vendor_name)+" [ "+d(B.memberInfo.acc_name)+" ] ",1)]),e(x,{class:"pb-2 d-flex flex-column justify-space-between",style:{height:"calc(100% - 64px)"}},{default:t(()=>[e(o,{ref_key:"searchFormRef",ref:j},{default:t(()=>[e(m,{dense:"",class:"flex-0-1"},{default:t(()=>[e(k,{cols:"12"},{default:t(()=>[...a[3]||(a[3]=[s("p",{class:"mt-1 mb-2 text-h6 text-blue-darken-3 text-center text-md-left"}," 折抵記錄查詢 ",-1)])]),_:1}),e(k,{cols:"12",md:"4"},{default:t(()=>[e(R,{modelValue:b.value.start_time,"onUpdate:modelValue":a[0]||(a[0]=c=>b.value.start_time=c),rules:T.value.startDateRule,"display-format":M(J),"prepend-icon":"","append-inner-icon":"fa:far fa-calendar-alt",placeholder:"起：2026-01-01",variant:"outlined",density:"compact",color:"blue-darken-2","bg-color":"white",required:""},null,8,["modelValue","rules","display-format"])]),_:1}),e(k,{cols:"12",md:"4"},{default:t(()=>[e(R,{modelValue:b.value.end_time,"onUpdate:modelValue":a[1]||(a[1]=c=>b.value.end_time=c),rules:T.value.endDateRule,"display-format":M(J),"prepend-icon":"","append-inner-icon":"fa:far fa-calendar-alt",placeholder:"迄：2026-01-01",variant:"outlined",density:"compact",color:"blue-darken-2","bg-color":"white",required:""},null,8,["modelValue","rules","display-format"])]),_:1}),e(k,{cols:"12"},{default:t(()=>[s("div",Se,[e(y,{color:"blue-darken-2",variant:"flat",class:"px-8 w-75 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40",onClick:le(N,["prevent"])},{default:t(()=>[...a[4]||(a[4]=[D(" 查詢 ",-1)])]),_:1}),s("div",Ue,[e(y,{color:"blue-darken-2",variant:"text",class:"px-2",height:"40"},{default:t(()=>[e(q,{height:"30",width:"35",src:`${M(v)}/images/ktorrent.svg`,cover:"",alt:"icon"},null,8,["src"])]),_:1})])])]),_:1})]),_:1})]),_:1},512),f.value.length>0?(r(),w(x,{key:0,class:"px-0 py-1"},{default:t(()=>[e(m,{"no-gutters":""},{default:t(()=>[e(k,{cols:"12"},{default:t(()=>[s("div",Re,[e(y,{color:"grey-lighten-1",variant:"flat",class:"my-2 px-8 text-h6 font-weight-regular text-white flex-1-1 flex-md-0-0",height:"40",onClick:L},{default:t(()=>[...a[5]||(a[5]=[D(" 全部 ",-1)])]),_:1}),e(y,{color:"grey-lighten-1",variant:"flat",class:"my-2 px-8 text-h6 font-weight-regular text-white flex-1-1 flex-md-0-0",height:"40",onClick:L},{default:t(()=>[...a[6]||(a[6]=[D(" 折抵 ",-1)])]),_:1}),e(y,{color:"grey-lighten-1",variant:"flat",class:"my-2 px-8 text-h6 font-weight-regular text-white flex-1-1 flex-md-0-0",height:"40",onClick:L},{default:t(()=>[...a[7]||(a[7]=[D(" 儲值 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})):S("",!0),f.value.length>0?(r(),w(P,{key:1,variant:"flat",class:"bg-white flex-grow-1 overflow-y-auto"},{default:t(()=>[e(g,null,{default:t(()=>[(r(!0),z(W,null,Y(f.value,c=>(r(),w(F,{class:"pa-0 border",key:c.id},{default:t(()=>[s("div",Be,[e(m,{"no-gutters":"",class:"align-center flex-grow-1"},{default:t(()=>[e(k,{cols:"4",md:"3"},{default:t(()=>[s("div",je,d(c.plate),1)]),_:2},1024),e(k,{cols:"3",md:"4",class:"pl-2 text-no-wrap"},{default:t(()=>[D(d(c.amount?c.amount:"-")+" 小時 ",1)]),_:2},1024),e(k,{cols:"5",md:"5",class:"pl-2 text-subtitle-1 text-grey-darken-2"},{default:t(()=>[s("div",Fe,[s("div",Pe,d(c.discount_time),1),s("div",ze,d(c.name)+" "+d(c.account),1)])]),_:2},1024)]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1}),e(ee,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=c=>i.value=c),message:h.value,messageTitle:I.value,isConfirmBtn:V.value,onPromptConfirm:_,onOnClose:O},null,8,["modelValue","message","messageTitle","isConfirmBtn"])])}}},Le={id:"shopView",class:"d-flex flex-column bg-grey-lighten-4 h-100"},Oe={class:"pt-2 d-flex align-center"},Ae={class:"ml-3 text-subtitle-1 font-weight-bold text-grey-darken-3"},Me={__name:"ShopView",setup(E){const H="https://peterhsj.github.io/RentalDemo",B=re(),$=l(null),v=l({}),i=l(!1),I=l(!1),h=l(!1),V=l(""),U=l(""),j=l(!1),b=a=>{v.value=a,i.value=!0,a.value==="logout"&&(localStorage.removeItem("memberInfo"),$.value=null)},T=()=>{v.value={},i.value=!1},f=()=>{v.value={},i.value=!1,B.push("/ShopLogin")},N=()=>{v.value={},i.value=!1},L=()=>{h.value=!1},_=()=>{h.value=!1},O=()=>{I.value=window.innerWidth<=960},u=()=>{if(localStorage.getItem("memberInfo"))$.value=JSON.parse(localStorage.getItem("memberInfo"));else{B.push("/ShopLogin");return}};return te(()=>{u(),O(),window.addEventListener("resize",O)}),oe(()=>{window.removeEventListener("resize",O)}),(a,p)=>{const A=n("v-img"),k=n("v-avatar"),R=n("v-card"),y=n("v-container");return r(),z("div",Le,[se(e(y,{class:"pb-1 rental rental__wrapper"},{default:t(()=>[e(R,{variant:"elevated",elevation:"4",class:"pa-2"},{default:t(()=>[e(A,{color:"surface-variant",height:"200",width:"100%",src:`${M(H)}/images/hotel_01.png`,cover:"",alt:"Shop Image"},{default:t(()=>[...p[1]||(p[1]=[s("h1",{class:"ml-6 mt-4 text-h5 font-weight-bold"},"商店消費停車折抵",-1)])]),_:1},8,["src"]),s("div",Oe,[e(k,{image:`${M(H)}/images/profile.svg`,size:"30"},null,8,["image"]),s("span",Ae,d($.value&&$.value.vendor_name)+" "+d($.value&&$.value.acc_name)+" 您好！ ",1)])]),_:1}),i.value?S("",!0):(r(),w(ie,{key:0,tabList:M(ue),onSetActiveTab:b},null,8,["tabList"]))]),_:1},512),[[ne,!I.value||!i.value]]),v.value.value==="parkingDeduction"?(r(),w(y,{key:0,id:"parkingDeduction",class:"rental rental__wrapper flex-grow-1 overflow-y-hidden"},{default:t(()=>[e(Ve,{activeTab:v.value,memberInfo:$.value,onCloseForm:T},null,8,["activeTab","memberInfo"])]),_:1})):S("",!0),v.value.value==="search"?(r(),w(y,{key:1,id:"search",class:"rental rental__wrapper flex-grow-1 overflow-y-hidden"},{default:t(()=>[e(Ne,{activeTab:v.value,memberInfo:$.value,onCloseForm:T},null,8,["activeTab","memberInfo"])]),_:1})):S("",!0),v.value.value==="logout"?(r(),w(y,{key:2,id:"logout",class:"rental rental__wrapper flex-grow-1 overflow-y-hidden"},{default:t(()=>[e(ce,{activeTab:v.value,onOnLogin:f},null,8,["activeTab"])]),_:1})):S("",!0),v.value.value==="changePassword"?(r(),w(y,{key:3,id:"changePassword",class:"rental rental__wrapper flex-grow-1 overflow-y-hidden"},{default:t(()=>[e(de,{activeTab:v.value,userInfo:$.value,onOnClose:N},null,8,["activeTab","userInfo"])]),_:1})):S("",!0),e(ee,{modelValue:h.value,"onUpdate:modelValue":p[0]||(p[0]=q=>h.value=q),message:U.value,messageTitle:V.value,isConfirmBtn:j.value,onPromptConfirm:L,onOnClose:_},null,8,["modelValue","message","messageTitle","isConfirmBtn"])])}}},Ke=fe(Me,[["__scopeId","data-v-794c1189"]]);export{Ke as default};
