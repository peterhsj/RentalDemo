import{h as c,r as G,y as q,a5 as r,ac as Q,a7 as x,n as e,ad as a,v as f,u as M,V as E,a2 as J,Z as V,a6 as F,af as S,H as K,a0 as Y,P as ee,Q as te}from"./vue-core-CsbKmrRr.js";import{_ as ae,p as oe}from"./TabList-C060IOAN.js";import{a as O}from"./index-BFZgDbVB.js";import{C as le,_ as ne}from"./CommonOverlay-CJOeYAfy.js";import{_ as se}from"./PromptDialog-TYGxE2y4.js";import{_ as re}from"./index-D8CXgDkW.js";import"./vuetify-CHkSyw28.js";import"./date-DE_Uv9Lq.js";const ie={id:"search",class:"h-100"},ce={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},ue={style:{width:"120px",height:"40px"}},de={class:"d-flex ga-2 flex-wrap justify-end w-100"},H={__name:"SearchForm",props:{activeTab:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})}},emits:["update:formData","closeForm","sendForm"],setup(k,{expose:R,emit:p}){const n=k,i=p,$="https://peterhsj.github.io/RentalDemo",m=c(),t=G(n.formData),u=c({phoneRules:[o=>!!o||"手機號碼為必填",o=>/^\d{10}$/.test(o)||"請輸入有效的手機號碼"],carRules:[o=>!!o||"車號為必填",o=>/^[A-Z0-9]+-[A-Z0-9]+$/.test(o)||"請輸入有效的車號 ( 需包含 - 符號 )"],captchaRules:[o=>!!o||"驗證碼為必填",o=>o===v.value||"請輸入有效的驗證碼"]});q(()=>n.formData,o=>{Object.assign(t,o)},{deep:!0}),q(()=>t,o=>{i("update:formData",o)},{deep:!0});const v=c(""),w=o=>{v.value=o},_=async()=>{const{valid:o}=await m.value.validate();o&&i("sendForm")},g=()=>{i("closeForm")};return R({initForm:()=>{m.value.reset()}}),(o,s)=>{const N=r("v-icon"),P=r("v-avatar"),T=r("v-text-field"),y=r("v-col"),L=r("v-row"),W=r("v-btn"),z=r("v-container"),D=r("v-form"),h=r("v-card");return x(),Q("div",ie,[e(h,{variant:"outlined",class:"rounded-lg bordered border-md bg-white h-100"},{default:a(()=>[f("div",{class:"px-4 py-3 d-flex align-center bg-orange-lighten-5 rental__header",onClick:g},[e(N,{icon:"fa:fas fa-chevron-left",size:"20",color:"grey-darken-1",class:"mr-2"}),e(P,{image:`${M($)}${n.activeTab.icon}`,size:"40"},null,8,["image"]),f("span",ce,E(n.activeTab.title),1)]),e(D,{ref_key:"parkingFormRef",ref:m,class:"h-100",onSubmit:J(_,["prevent"])},{default:a(()=>[e(z,{class:"pb-2 d-flex flex-column justify-space-between",style:{height:"calc(100% - 64px)"}},{default:a(()=>[e(L,{dense:"",class:"flex-0-1"},{default:a(()=>[e(y,{cols:"12",md:"6"},{default:a(()=>[e(T,{modelValue:t.phone,"onUpdate:modelValue":s[0]||(s[0]=l=>t.phone=l),placeholder:n.activeTab.value==="parking"?"請輸入手機號碼":"請輸入登記手機號碼",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:u.value.phoneRules,required:""},null,8,["modelValue","placeholder","rules"])]),_:1}),e(y,{cols:"12",md:"6"},{default:a(()=>[e(T,{modelValue:t.license_plate,"onUpdate:modelValue":s[1]||(s[1]=l=>t.license_plate=l),placeholder:n.activeTab.value==="parking"?"請輸入車號":"請輸入已登記車號",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:u.value.carRules,onInput:s[2]||(s[2]=l=>t.license_plate=t.license_plate.toUpperCase()),required:""},null,8,["modelValue","placeholder","rules"])]),_:1}),e(y,{cols:"12",class:"py-0"},{default:a(()=>[...s[5]||(s[5]=[f("p",{class:"text-subtitle-1 font-weight-bold"},"驗證碼",-1)])]),_:1}),e(y,{cols:"12",md:"6"},{default:a(()=>[e(T,{modelValue:t.captcha,"onUpdate:modelValue":s[3]||(s[3]=l=>t.captcha=l),placeholder:"請輸入驗證碼",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:u.value.captchaRules,onInput:s[4]||(s[4]=l=>t.captcha=t.captcha.toUpperCase()),required:""},{append:a(()=>[f("div",ue,[e(le,{onSetCaptchaCode:w})])]),_:1},8,["modelValue","rules"])]),_:1}),e(y,{cols:"12"},{default:a(()=>[...s[6]||(s[6]=[f("p",{class:"text-subtitle-2 text-red-darken-1"},[V(" 注意："),f("br"),V(" 更換車號請重新操作，入場當日無法更換登記車號。 ")],-1)])]),_:1})]),_:1}),e(L,{"no-gutters":"",class:"flex-0-1"},{default:a(()=>[e(y,{cols:"12",class:"mt-4"},{default:a(()=>[f("div",de,[e(W,{type:"submit",color:"light-green-darken-2",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40"},{default:a(()=>[V(E(n.activeTab.value==="parking"?"登記":"查詢"),1)]),_:1}),e(W,{color:"blue-darken-3",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40",onClick:g},{default:a(()=>[...s[7]||(s[7]=[V(" 離開 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})])}}},fe={class:"d-flex flex-column align-center justify-center"},me={class:"my-4"},pe=["innerHTML"],ve={class:"d-flex ga-2 flex-wrap justify-center w-100"},_e={__name:"InfoView",props:{info:{type:String,default:""},infoStatus:{type:String,default:"success"}},emits:["infoClose","reWrite"],setup(k,{emit:R}){const p="https://peterhsj.github.io/RentalDemo",n=R,i=()=>{n("infoClose")},$=()=>{n("reWrite")};return(m,t)=>{const u=r("v-img"),v=r("v-btn"),w=r("v-col"),_=r("v-row"),g=r("v-container"),C=r("v-card");return x(),F(g,{class:"rental rental__wrapper flex-grow-1"},{default:a(()=>[e(C,{variant:"outlined",class:"mb-5 pt-5 d-flex flex-column justify-space-between rounded-lg bordered border-md bg-white h-100"},{default:a(()=>[f("div",fe,[f("span",me,[e(u,{height:"100%",width:"120px",src:k.infoStatus==="success"?`${M(p)}/images/check.svg`:`${M(p)}/images/warning.svg`,cover:"",alt:"icon image"},null,8,["src"])]),f("div",{class:"d-flex flex-column align-center justify-center pa-6",innerHTML:k.info},null,8,pe)]),e(g,{class:"py-2"},{default:a(()=>[e(_,{"no-gutters":""},{default:a(()=>[e(w,{cols:"12"},{default:a(()=>[f("div",ve,[k.infoStatus!=="error"?(x(),F(v,{key:0,color:"blue-darken-3",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40",onClick:i},{default:a(()=>[...t[0]||(t[0]=[V(" 離開 ",-1)])]),_:1})):S("",!0),k.infoStatus==="error"?(x(),F(v,{key:1,color:"orange-darken-3",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40",onClick:$},{default:a(()=>[...t[1]||(t[1]=[V(" 重新輸入 ",-1)])]),_:1})):S("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},ge={id:"parkingView",class:"d-flex flex-column bg-grey-lighten-4 h-100"},he={__name:"ParkingView",setup(k){const R="https://peterhsj.github.io/RentalDemo",p=c(!1),n=c({}),i=c(!1),$=c(!1),m=c(),t=c({ischeck:0,phone:"",license_plate:"",captcha:""}),u=c(!1),v=c(""),w=c(""),_=c(!1),g=c(""),C=c(""),o=c(!1),s=h=>{if(h.value==="parkingInfo"){window.open("https://www.grand-hotel.org/TW/official/about-traffic.aspx?gh=TP","_blank");return}n.value=h,i.value=!0},N=async()=>{const{ischeck:h,phone:l,license_plate:U}=t.value,j={ischeck:h,phone:l,license_plate:U};p.value=!0;const b="/member/grand_hotel/register_cus?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const d=await O.post(b,j),{returnCode:B,message:I,data:A}=d;B===0?P():B===-1?(v.value=`<p class="my-2 text-h4 text-grey-darken-1 font-weight-bold">
            查無登記資訊
          </p>
          <p class="mt-4 mb-7 text-h5 text-amber-darken-3 font-weight-bold text-center">
            請重新確認登記手機號碼或再次輸入
          </p>
          <p class="mt-7 mb-0 text-h5 text-grey-darken-1 text-center">
            另可聯繫飯店客服<br>
            02-1234567
          </p>`,i.value=!1,u.value=!0,w.value="error",m.value.initForm()):B===3?(g.value="登記手機號碼已有申請車輛",C.value=`${I}`,o.value=!0,_.value=!0):(g.value="訊息通知",C.value=`${I}`,o.value=!1,_.value=!0)}catch(d){console.log({err:d})}finally{p.value=!1}},P=async()=>{const{phone:h,license_plate:l}=t.value,U={phone:h,license_plate:l};p.value=!0;const j="/member/grand_hotel/select_cus?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const b=await O.post(j,U),{returnCode:d,message:B,data:I}=b;if(console.log("data",d,B,I),d===0){const{license_plate:A,reserve_start_date:Z,reserve_end_date:X}=I[0];i.value=!1,u.value=!0,w.value="success",v.value=`<p class="text-h4 text-grey-darken-1 font-weight-bold my-2">
          已完成登記
        </p>
        <p class="rental__text--h45 text-grey-darken-1 font-weight-bold mt-3">
          車號
        </p>
        <p class="text-h5 text-amber-darken-3 font-weight-bold my-0">
          ${A}
        </p>
        <p class="rental__text--h45 text-grey-darken-1 font-weight-bold mt-4">
          停放日期
        </p>
        <p class="text-h5 text-amber-darken-3 font-weight-bold my-0">
          ${Z} ~ ${X}
        </p>`,m.value.initForm()}else d===-1&&(v.value=`<p class="my-2 text-h4 text-grey-darken-1 font-weight-bold">
            查無登記資訊
          </p>
          <p class="mt-4 mb-7 text-h5 text-amber-darken-3 font-weight-bold text-center">
            請重新確認登記手機號碼或再次輸入
          </p>
          <p class="mt-7 mb-0 text-h5 text-grey-darken-1 text-center">
            另可聯繫飯店客服<br>
            02-1234567
          </p>`,i.value=!1,u.value=!0,w.value="error",m.value.initForm()),d===3&&(g.value="登記手機號碼已有申請車輛",C.value=`<p>此電話已經申請車號 ${l}，確認是否要覆蓋原有車號？</p>`,o.value=!0,_.value=!0)}catch(b){console.log({err:b})}finally{p.value=!1}},T=()=>{n.value={},m.value.initForm(),i.value=!1},y=()=>{u.value=!1,i.value=!0},L=()=>{u.value=!1,i.value=!1,n.value={},t.value={phoneNumber:"",carNumber:"",captcha:""}},W=()=>{t.value.ischeck=1,N()},z=()=>{_.value=!1},D=()=>{$.value=window.innerWidth<=960};return K(()=>{D(),window.addEventListener("resize",D)}),Y(()=>{window.removeEventListener("resize",D)}),(h,l)=>{const U=r("v-img"),j=r("v-card"),b=r("v-container");return x(),Q("div",ge,[ee(e(b,{class:"pb-1 rental rental__wrapper"},{default:a(()=>[e(j,{variant:"elevated",elevation:"4",class:"pa-2"},{default:a(()=>[e(U,{color:"surface-variant",height:"200",width:"100%",src:`${M(R)}/images/hotel_01.png`,cover:"",alt:"Parking Image"},{default:a(()=>[...l[3]||(l[3]=[f("h1",{class:"ml-6 mt-4 text-h5 font-weight-bold"},"住宿車輛登記",-1)])]),_:1},8,["src"])]),_:1}),!i.value&&!u.value?(x(),F(ae,{key:0,tabList:M(oe),onSetActiveTab:s},null,8,["tabList"])):S("",!0)]),_:1},512),[[te,(!$.value||!i.value)&&!u.value]]),i.value&&n.value.value==="parking"?(x(),F(b,{key:0,id:"parking",class:"rental rental__wrapper flex-grow-1 overflow-y-hidden"},{default:a(()=>[e(H,{ref_key:"searchFormRef",ref:m,formData:t.value,"onUpdate:formData":l[0]||(l[0]=d=>t.value=d),activeTab:n.value,onCloseForm:T,onSendForm:N},null,8,["formData","activeTab"])]),_:1})):S("",!0),i.value&&n.value.value==="search"?(x(),F(b,{key:1,id:"search",class:"rental rental__wrapper flex-grow-1 overflow-y-hidden"},{default:a(()=>[e(H,{ref_key:"searchFormRef",ref:m,formData:t.value,"onUpdate:formData":l[1]||(l[1]=d=>t.value=d),activeTab:n.value,onCloseForm:T,onSendForm:P},null,8,["formData","activeTab"])]),_:1})):S("",!0),u.value?(x(),F(_e,{key:2,infoStatus:w.value,info:v.value,onInfoClose:L,onReWrite:y},null,8,["infoStatus","info"])):S("",!0),e(se,{modelValue:_.value,"onUpdate:modelValue":l[2]||(l[2]=d=>_.value=d),message:C.value,messageTitle:g.value,isConfirmBtn:o.value,onPromptConfirm:W,onOnClose:z},null,8,["modelValue","message","messageTitle","isConfirmBtn"]),e(ne,{overlay:p.value},null,8,["overlay"])])}}},Te=re(he,[["__scopeId","data-v-29f89049"]]);export{Te as default};
