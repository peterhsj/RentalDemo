import{_ as D}from"./PromptDialog.vue_vue_type_script_setup_true_lang-BQ-rZPSt.js";import{_ as j,a as A}from"./Captcha-D_pvARcH.js";import{l as O,ag as z,ad as M,aa as E,n as t,ab as l,v as r,o as H,u as d,h as J,Y as Q,a5 as X,k as n,a0 as _}from"./vue-core-Bc_tOqtV.js";import{a as Y}from"./index-BFZgDbVB.js";import{l as G,q as K,m as W,n as q,o as i,r as x,f as Z,j as ee}from"./index-EmV6I_33.js";const te={id:"login",class:"pa-5 mx-auto h-100 rental rental__wrapper"},ae={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},oe={style:{width:"120px",height:"40px"}},le={class:"d-flex ga-2 flex-wrap justify-end w-100"},de=O({__name:"LoginView",props:{currentPath:{default:"counterLogin"}},setup(F){const u=F,U="/RentalDemo/",m=z(),c=n(!1),C=n(""),V=n(""),L=n(!1),R={counterLogin:{title:"住宿車輛登記 - 登入",bgColor:"bg-grey-lighten-2",icon:"/images/bed.svg"},shopLogin:{title:"商店消費折抵 - 登入",bgColor:"bg-orange-lighten-5",icon:"/images/shoppingCart.svg"},banquetLogin:{title:"宴會廳消費折抵 - 登入",bgColor:"rental__bg--light-orange",icon:"/images/scanner.svg"}},f=n(!1),k=n(null),s=n({account:"",password:"",captcha:""}),P=n(""),p=n(!1),g={accountRules:[o=>!!o||"帳號為必填"],passwordRules:[o=>!!o||"密碼為必填"],captchaRules:[o=>!!o||"驗證碼為必填",o=>o===P.value||"請輸入有效的驗證碼"]},v=J(()=>{const o=u.currentPath;return R[o]||R.counterLogin});function S(o){P.value=o}async function $(){const{valid:o}=await k.value?.validate()??{valid:!1};if(!o)return;let e=null;u.currentPath==="counterLogin"&&(e=4),u.currentPath==="shopLogin"&&(e=1),u.currentPath==="banquetLogin"&&(e=5);const{account:h,password:b}=s.value,y={store_type:e,account:h,password:b};f.value=!0;const a="/member/grand_hotel/login?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const w=await Y.post(a,y),{returnCode:I,message:N,data:T}=w;if(I===0){if(localStorage.setItem("memberInfo",JSON.stringify(T)),u.currentPath==="counterLogin"){m.push("/counter");return}if(u.currentPath==="shopLogin"){m.push("/shop");return}if(u.currentPath==="banquetLogin"){m.push("/banquet");return}}else{C.value="登入失敗",V.value=`<span class="text-body-2">${N}</span>`,L.value=!1,c.value=!0;return}}catch(w){console.log({err:w})}finally{f.value=!1}}function B(){c.value=!1}return(o,e)=>{const h=j,b=A,y=D;return E(),M("div",te,[t(ee,{class:"rounded-lg bordered border-md bg-white h-100",variant:"outlined"},{default:l(()=>[r("div",{class:H(["px-4 py-3 d-flex align-center",d(v).bgColor])},[r("span",null,[t(G,{alt:"icon",cover:"",height:"40",src:`${d(U)}${d(v).icon}`,width:"45"},null,8,["src"])]),r("span",ae,Q(d(v).title),1)],2),t(d(K),{ref_key:"loginFormRef",ref:k,class:"h-100",onSubmit:X($,["prevent"])},{default:l(()=>[t(W,{class:"pb-2 d-flex flex-column justify-space-between",style:{height:"calc(100% - 64px)"}},{default:l(()=>[t(q,{class:"flex-0-1",dense:""},{default:l(()=>[t(i,{cols:"12",md:"6"},{default:l(()=>[t(x,{modelValue:s.value.account,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.account=a),autocomplete:"new-account",color:"blue-darken-2",density:"compact",name:"account-field",placeholder:"請輸入帳號",readonly:"",required:"",rules:g.accountRules,variant:"outlined",onFocus:e[1]||(e[1]=a=>a.target.removeAttribute("readonly"))},null,8,["modelValue","rules"])]),_:1}),t(i,{cols:"12",md:"6"},{default:l(()=>[t(x,{modelValue:s.value.password,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.password=a),"append-inner-icon":p.value?"fa:far fa-eye-slash":"fa:far fa-eye",autocomplete:"new-password",color:"blue-darken-2",density:"compact",name:"password-field",placeholder:"請輸入密碼",readonly:"",required:"",rules:g.passwordRules,type:p.value?"text":"password",variant:"outlined","onClick:appendInner":e[3]||(e[3]=a=>p.value=!p.value),onFocus:e[4]||(e[4]=a=>a.target.removeAttribute("readonly"))},null,8,["modelValue","append-inner-icon","rules","type"])]),_:1}),t(i,{class:"py-0",cols:"12"},{default:l(()=>[...e[8]||(e[8]=[r("p",{class:"text-subtitle-1 font-weight-bold"},"驗證碼",-1)])]),_:1}),t(i,{cols:"12",md:"6"},{default:l(()=>[t(x,{modelValue:s.value.captcha,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.captcha=a),autocomplete:"off",color:"blue-darken-2",density:"compact",placeholder:"請輸入驗證碼",required:"",rules:g.captchaRules,variant:"outlined",onInput:e[6]||(e[6]=a=>s.value.captcha=s.value.captcha.toUpperCase())},{append:l(()=>[r("div",oe,[t(h,{onSetCaptchaCode:S})])]),_:1},8,["modelValue","rules"])]),_:1}),t(i,{cols:"12"},{default:l(()=>[...e[9]||(e[9]=[r("p",{class:"text-subtitle-2 text-red-darken-1"},[_(" 注意："),r("br"),_(" 更換車號請重新操作，入場當日無法更換登記車號。 ")],-1)])]),_:1})]),_:1}),t(q,{class:"flex-0-1","no-gutters":""},{default:l(()=>[t(i,{class:"mt-4",cols:"12"},{default:l(()=>[r("div",le,[t(Z,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",color:"light-green-darken-2",height:"40",type:"submit",variant:"flat"},{default:l(()=>[...e[10]||(e[10]=[_(" 登入 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),t(b,{overlay:f.value},null,8,["overlay"]),t(y,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a),"is-confirm-btn":L.value,message:V.value,"message-title":C.value,onOnClose:B},null,8,["modelValue","is-confirm-btn","message","message-title"])])}}});export{de as _};
