import{_ as j,a as D}from"./index-BQ43x7GY.js";import{_ as A,a as O}from"./Captcha-iRw-bweG.js";import{l as z,ag as M,ad as E,aa as H,n as a,ab as l,v as r,o as J,u as d,j as Q,Y as X,a5 as Y,k as n,a0 as _}from"./vue-core-BRXIlfIm.js";import{c as G,j as K,d as W,e as q,f as i,k as x,h as Z,a as ee}from"./index-KngcH0fI.js";const ae={id:"login",class:"pa-5 mx-auto h-100 rental rental__wrapper"},te={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},oe={style:{width:"120px",height:"40px"}},le={class:"d-flex ga-2 flex-wrap justify-end w-100"},ie=z({__name:"LoginView",props:{currentPath:{default:"counterLogin"}},setup(F){const u=F,U="/RentalDemo/",m=M(),c=n(!1),C=n(""),V=n(""),k=n(!1),L={counterLogin:{title:"住宿車輛登記 - 登入",bgColor:"bg-grey-lighten-2",icon:"/images/bed.svg"},shopLogin:{title:"商店消費折抵 - 登入",bgColor:"bg-orange-lighten-5",icon:"/images/shoppingCart.svg"},banquetLogin:{title:"宴會廳消費折抵 - 登入",bgColor:"rental__bg--light-orange",icon:"/images/scanner.svg"}},f=n(!1),R=n(null),s=n({account:"",password:"",captcha:""}),P=n(""),p=n(!1),g={accountRules:[o=>!!o||"帳號為必填"],passwordRules:[o=>!!o||"密碼為必填"],captchaRules:[o=>!!o||"驗證碼為必填",o=>o===P.value||"請輸入有效的驗證碼"]},v=Q(()=>{const o=u.currentPath;return L[o]||L.counterLogin});function S(o){P.value=o}async function $(){const{valid:o}=await R.value?.validate()??{valid:!1};if(!o)return;let e=null;u.currentPath==="counterLogin"&&(e=4),u.currentPath==="shopLogin"&&(e=1),u.currentPath==="banquetLogin"&&(e=5);const{account:h,password:b}=s.value,y={store_type:e,account:h,password:b};f.value=!0;const t="/member/grand_hotel/login?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const w=await D.post(t,y),{returnCode:I,message:N,data:T}=w;if(I===0){if(localStorage.setItem("memberInfo",JSON.stringify(T)),u.currentPath==="counterLogin"){m.push("/counter");return}if(u.currentPath==="shopLogin"){m.push("/shop");return}if(u.currentPath==="banquetLogin"){m.push("/banquet");return}}else{C.value="登入失敗",V.value=`<span class="text-body-2">${N}</span>`,k.value=!1,c.value=!0;return}}catch(w){console.log({err:w})}finally{f.value=!1}}function B(){c.value=!1}return(o,e)=>{const h=A,b=O,y=j;return H(),E("div",ae,[a(ee,{class:"rounded-lg bordered border-md bg-white h-100",variant:"outlined"},{default:l(()=>[r("div",{class:J(["px-4 py-3 d-flex align-center",d(v).bgColor])},[r("span",null,[a(G,{alt:"icon",cover:"",height:"40",src:`${d(U)}${d(v).icon}`,width:"45"},null,8,["src"])]),r("span",te,X(d(v).title),1)],2),a(d(K),{ref_key:"loginFormRef",ref:R,class:"h-100",onSubmit:Y($,["prevent"])},{default:l(()=>[a(W,{class:"pb-2 d-flex flex-column justify-space-between",style:{height:"calc(100% - 64px)"}},{default:l(()=>[a(q,{class:"flex-0-1",dense:""},{default:l(()=>[a(i,{cols:"12",md:"6"},{default:l(()=>[a(x,{modelValue:s.value.account,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.account=t),autocomplete:"new-account",color:"blue-darken-2",density:"compact",name:"account-field",placeholder:"請輸入帳號",readonly:"",required:"",rules:g.accountRules,variant:"outlined",onFocus:e[1]||(e[1]=t=>t.target.removeAttribute("readonly"))},null,8,["modelValue","rules"])]),_:1}),a(i,{cols:"12",md:"6"},{default:l(()=>[a(x,{modelValue:s.value.password,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.password=t),"append-inner-icon":p.value?"fa:far fa-eye-slash":"fa:far fa-eye",autocomplete:"new-password",color:"blue-darken-2",density:"compact",name:"password-field",placeholder:"請輸入密碼",readonly:"",required:"",rules:g.passwordRules,type:p.value?"text":"password",variant:"outlined","onClick:appendInner":e[3]||(e[3]=t=>p.value=!p.value),onFocus:e[4]||(e[4]=t=>t.target.removeAttribute("readonly"))},null,8,["modelValue","append-inner-icon","rules","type"])]),_:1}),a(i,{class:"py-0",cols:"12"},{default:l(()=>[...e[8]||(e[8]=[r("p",{class:"text-subtitle-1 font-weight-bold"},"驗證碼",-1)])]),_:1}),a(i,{cols:"12",md:"6"},{default:l(()=>[a(x,{modelValue:s.value.captcha,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.captcha=t),autocomplete:"off",color:"blue-darken-2",density:"compact",placeholder:"請輸入驗證碼",required:"",rules:g.captchaRules,variant:"outlined",onInput:e[6]||(e[6]=t=>s.value.captcha=s.value.captcha.toUpperCase())},{append:l(()=>[r("div",oe,[a(h,{onSetCaptchaCode:S})])]),_:1},8,["modelValue","rules"])]),_:1}),a(i,{cols:"12"},{default:l(()=>[...e[9]||(e[9]=[r("p",{class:"text-subtitle-2 text-red-darken-1"},[_(" 注意："),r("br"),_(" 更換車號請重新操作，入場當日無法更換登記車號。 ")],-1)])]),_:1})]),_:1}),a(q,{class:"flex-0-1","no-gutters":""},{default:l(()=>[a(i,{class:"mt-4",cols:"12"},{default:l(()=>[r("div",le,[a(Z,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",color:"light-green-darken-2",height:"40",type:"submit",variant:"flat"},{default:l(()=>[...e[10]||(e[10]=[_(" 登入 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),a(b,{overlay:f.value},null,8,["overlay"]),a(y,{modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t),"is-confirm-btn":k.value,message:V.value,"message-title":C.value,onOnClose:B},null,8,["modelValue","is-confirm-btn","message","message-title"])])}}});export{ie as _};
