import{_ as J,a as P}from"./index-a7hFABmP.js";import{l as K,ag as Z,ah as ee,H as ae,a3 as te,ad as C,aa as _,n as t,ab as l,v as n,u as F,Y as c,k as s,af as T,a0 as h,a9 as le,F as A,ae as se}from"./vue-core-BRXIlfIm.js";import{a as q,i as ne,d as D,j as oe,e as M,f as R,k as re,h as U}from"./index-CGtCHxHa.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./date-ui-TtEhfnKH.js";import"./vuetify-ui-CxbL1ZWO.js";const ie={id:"banquet",class:"d-flex flex-column bg-grey-lighten-4 h-100"},ce={class:"px-4 py-3 d-flex align-center bg-orange-lighten-5"},de={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},ve={class:"h-100"},fe={key:0},me={class:"py-2 text-h5 font-weight-bold"},pe={class:"mt-5 d-flex flex-column align-center justify-center"},ge={class:"my-1"},_e={class:"text-h3 font-weight-bold"},he={class:"mt-3 d-flex flex-wrap justify-center w-100"},ye={class:"mt-3 d-flex flex-wrap justify-center w-100"},xe=K({__name:"customer",setup(be){const z="/RentalDemo/",I=Z(),y=ee(),L=s(!1);function x(o){try{const e=atob(o),i=Uint8Array.from(e,a=>a.codePointAt(0)??0);return new TextDecoder().decode(i)}catch(e){return console.error("Base64 解碼錯誤:",e),o}}const r=s({}),u=s({});function j(){r.value={c:y.query.c,v:y.query.v,u:y.query.u,vn:y.query.vn},r.value.c&&(u.value.c=Number(x(r.value.c))),r.value.v&&(u.value.v=Number(x(r.value.v))),r.value.u&&(u.value.u=Number(x(r.value.u))),r.value.vn&&(u.value.vn=x(r.value.vn))}const b=s(!1),d=s(!1),w=s(""),m=s(""),p=s(!1),$=s(null),g=s({license_plate:""}),E=s({carRules:[o=>!!o||"車號為必填",o=>!/[-]/.test(o)||"車號不需輸入 - 符號"]}),Q=s(!0),v=s(null),k=s([]);async function B(){v.value=null,k.value=[];const{valid:o}=await $.value?.validate()??{valid:!1};if(!o)return;const{license_plate:e}=g.value,i={license_plate:e};b.value=!0;const a="/member/grand_hotel/car_in_park_sel?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const f=await P.post(a,i),{returnCode:W,message:Y,data:N,discount:G}=f;W===0?(v.value=N,k.value=G,N.ischeck!==0&&(w.value="訊息通知",m.value=N.ischeck===1?`${e} 已進行住宿折抵，無法再折抵`:`${e} 折抵已到達上限，無法再折抵`,p.value=!1,d.value=!0)):(w.value="訊息通知",m.value=`${Y}`,p.value=!1,d.value=!0)}catch(f){console.log({err:f})}finally{b.value=!1}}async function X(){const o={license_plate:v.value?.license_plate,count:u.value.c,vendorId:u.value.v,userId:u.value.u};b.value=!0;const e="/member/grand_hotel/register_qr?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const i=await P.post(e,o),{returnCode:a,message:f}=i;a===0?(B(),m.value=`${f}`,p.value=!1,d.value=!0):(w.value="訊息通知",m.value=`${f}`,p.value=!1,d.value=!0)}catch(i){console.log({err:i})}finally{b.value=!1}}function H(){I.push("/Customer")}function O(){d.value=!1}function S(){d.value=!1}function V(){L.value=window.innerWidth<=960}return ae(()=>{V(),window.addEventListener("resize",V),j()}),te(()=>{window.removeEventListener("resize",V)}),(o,e)=>{const i=J;return _(),C("div",ie,[t(D,{id:"search",class:"rental rental__wrapper h-100",style:{"max-width":"600px"}},{default:l(()=>[t(q,{class:"rounded-lg bordered border-md bg-white h-100",variant:"outlined"},{default:l(()=>[n("div",ce,[t(ne,{image:`${F(z)}/images/check.svg`,size:"40"},null,8,["image"]),n("span",de,c(u.value.vn),1)]),t(D,{class:"pb-2 d-flex flex-column flex-grow-1 overflow-y-auto",style:{height:"calc(100% - 64px)"}},{default:l(()=>[n("div",ve,[t(F(oe),{ref_key:"searchFormRef",ref:$,class:"pt-4 py-1"},{default:l(()=>[t(M,{dense:""},{default:l(()=>[t(R,{cols:"12"},{default:l(()=>[t(re,{modelValue:g.value.license_plate,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value.license_plate=a),modelModifiers:{trim:!0},autocomplete:"off","bg-color":"white",class:"pr-0",color:"blue-darken-2",density:"compact",placeholder:"請輸入車號",required:"",rules:E.value.carRules,variant:"outlined",onInput:e[1]||(e[1]=a=>g.value.license_plate=g.value.license_plate.toUpperCase())},{"append-inner":l(()=>[t(U,{class:"mr-n3 px-3",color:"blue-darken-3",height:"40",type:"button",variant:"flat",onClick:B},{default:l(()=>[...e[3]||(e[3]=[h(" 查詢 ",-1)])]),_:1})]),_:1},8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512),v.value?(_(),C("div",fe,[t(q,{class:"py-5 px-2 rounded-lg bg-blue-darken-3 text-center",variant:"flat"},{default:l(()=>[e[4]||(e[4]=n("p",{class:"py-2 text-h6 font-weight-regular"},"入場資訊",-1)),n("p",me,c(v.value.license_plate),1),n("p",null,c(v.value.arrival_time),1)]),_:1}),n("div",pe,[e[6]||(e[6]=n("p",{class:"my-4 text-h6"},"應繳金額",-1)),n("p",ge,[e[5]||(e[5]=n("span",{class:"mr-1"},"NT$",-1)),n("span",_e,c(v.value.paymentAmount),1)])]),n("div",he,[t(U,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular text-white",color:"light-green-darken-2",disabled:v.value.ischeck!==0,height:"60","min-width":"200",variant:"flat",onClick:X},{default:l(()=>[h(" 折抵 "+c(u.value.c)+" 小時 ",1)]),_:1},8,["disabled"])]),n("div",ye,[t(U,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",color:"orange-darken-2",disabled:!Q.value,height:"60","min-width":"200",variant:"flat",onClick:H},{default:l(()=>[...e[7]||(e[7]=[h(" 線上繳費 ",-1)])]),_:1},8,["disabled"])]),k.value.length>0?(_(),le(q,{key:0,class:"my-5 pa-3 rounded-lg bg-grey-lighten-4 w-100",variant:"flat"},{default:l(()=>[t(M,{dense:""},{default:l(()=>[(_(!0),C(A,null,se(k.value,(a,f)=>(_(),C(A,{key:f},[t(R,{class:"text-grey-darken-1",cols:"8"},{default:l(()=>[h(c(a.vendor_name),1)]),_:2},1024),t(R,{class:"text-grey-darken-1",cols:"4"},{default:l(()=>[h(c(a.store_type===2?"$":"")+" "+c(a.amount)+" "+c(a.store_type===1||a.store_type===5?"hr":""),1)]),_:2},1024)],64))),128))]),_:1})]),_:1})):T("",!0)])):T("",!0)])]),_:1})]),_:1}),t(i,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),"is-confirm-btn":p.value,message:m.value,"message-title":w.value,onOnClose:S,onPromptConfirm:O},null,8,["modelValue","is-confirm-btn","message","message-title"])]),_:1})])}}}),Re=ue(xe,[["__scopeId","data-v-140f1954"]]);export{Re as default};
