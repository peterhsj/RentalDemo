import{_ as H,a as B}from"./index-s6bzZmYx.js";import{l as J,ag as Z,ah as ee,K as ae,a3 as te,ad as b,aa as h,n as t,ab as l,v as n,u as P,Y as i,k as s,af as F,a0 as y,a9 as le,F as T,ae as se}from"./vue-core-C94_ekHB.js";import{j as R,p as ne,m as A,q as oe,n as D,o as U,r as re,f as $}from"./index-BnP_PCoF.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./date-ui-TtEhfnKH.js";import"./vuetify-ui-B52qq8mj.js";const ie={id:"banquet",class:"d-flex flex-column bg-grey-lighten-4 h-100"},ce={class:"px-4 py-3 d-flex align-center bg-orange-lighten-5"},de={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},ve={class:"h-100"},fe={key:0},me={class:"py-2 text-h5 font-weight-bold"},pe={class:"mt-5 d-flex flex-column align-center justify-center"},ge={class:"my-1"},_e={class:"text-h3 font-weight-bold"},he={class:"mt-3 d-flex flex-wrap justify-center w-100"},ye={class:"mt-3 d-flex flex-wrap justify-center w-100"},xe=J({__name:"customer",setup(we){const M="/RentalDemo/",z=Z(),k=ee(),L=s(!1);function C(o){try{const e=atob(o),r=Uint8Array.from(e,a=>a.codePointAt(0)??0);return new TextDecoder().decode(r)}catch(e){return console.error("Base64 解碼錯誤:",e),o}}const v=s({}),f=s({});function j(){v.value={c:k.query.c,v:k.query.v,vn:k.query.vn},v.value.c&&(f.value.c=Number(C(v.value.c))),v.value.v&&(f.value.v=Number(C(v.value.v))),v.value.vn&&(f.value.vn=C(v.value.vn))}const x=s(!1),c=s(!1),w=s(""),m=s(""),p=s(!1),V=s(null),g=s({license_plate:""}),I=s({carRules:[o=>!!o||"車號為必填",o=>!/[-]/.test(o)||"車號不需輸入 - 符號"]}),E=s(!0),u=s(null),_=s([]);async function Q(){u.value=null,_.value=[];const{valid:o}=await V.value?.validate()??{valid:!1};if(!o)return;const{license_plate:e}=g.value,r={license_plate:e};x.value=!0;const a="/member/grand_hotel/car_in_park_sel?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const d=await B.post(a,r),{returnCode:W,message:Y,data:N,discount:G}=d;W===0?(u.value=N,_.value=G,N.ischeck!==0&&(w.value="訊息通知",m.value=N.ischeck===1?`${e} 已進行住宿折抵，無法再折抵`:`${e} 折抵已到達上限，無法再折抵`,p.value=!1,c.value=!0)):(w.value="訊息通知",m.value=`${Y}`,p.value=!1,c.value=!0)}catch(d){console.log({err:d})}finally{x.value=!1}}async function X(){const o={license_plate:u.value?.license_plate,count:f.value.c,vendorId:f.value.v};x.value=!0;const e="/member/grand_hotel/register_qr?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const r=await B.post(e,o);console.log({res:r});const{returnCode:a,message:d}=r;a===0?(u.value=null,_.value=[],V.value?.reset(),m.value=`${d}`,p.value=!1,c.value=!0):(w.value="訊息通知",m.value=`${d}`,p.value=!1,c.value=!0)}catch(r){console.log({err:r})}finally{x.value=!1}}function K(){z.push("/Customer")}function O(){c.value=!1}function S(){c.value=!1}function q(){L.value=window.innerWidth<=960}return ae(()=>{q(),window.addEventListener("resize",q),j()}),te(()=>{window.removeEventListener("resize",q)}),(o,e)=>{const r=H;return h(),b("div",ie,[t(A,{id:"search",class:"rental rental__wrapper h-100",style:{"max-width":"600px"}},{default:l(()=>[t(R,{class:"rounded-lg bordered border-md bg-white h-100",variant:"outlined"},{default:l(()=>[n("div",ce,[t(ne,{image:`${P(M)}/images/check.svg`,size:"40"},null,8,["image"]),n("span",de,i(f.value.vn),1)]),t(A,{class:"pb-2 d-flex flex-column flex-grow-1 overflow-y-auto",style:{height:"calc(100% - 64px)"}},{default:l(()=>[n("div",ve,[t(P(oe),{ref_key:"searchFormRef",ref:V,class:"pt-4 py-1"},{default:l(()=>[t(D,{dense:""},{default:l(()=>[t(U,{cols:"12"},{default:l(()=>[t(re,{modelValue:g.value.license_plate,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value.license_plate=a),modelModifiers:{trim:!0},autocomplete:"off","bg-color":"white",class:"pr-0",color:"blue-darken-2",density:"compact",placeholder:"請輸入車號",required:"",rules:I.value.carRules,variant:"outlined",onInput:e[1]||(e[1]=a=>g.value.license_plate=g.value.license_plate.toUpperCase())},{"append-inner":l(()=>[t($,{class:"mr-n3 px-3",color:"blue-darken-3",height:"40",type:"button",variant:"flat",onClick:Q},{default:l(()=>[...e[3]||(e[3]=[y(" 查詢 ",-1)])]),_:1})]),_:1},8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512),u.value?(h(),b("div",fe,[t(R,{class:"py-5 px-2 rounded-lg bg-blue-darken-3 text-center",variant:"flat"},{default:l(()=>[e[4]||(e[4]=n("p",{class:"py-2 text-h6 font-weight-regular"},"入場資訊",-1)),n("p",me,i(u.value.license_plate),1),n("p",null,i(u.value.arrival_time),1)]),_:1}),n("div",pe,[e[6]||(e[6]=n("p",{class:"my-4 text-h6"},"應繳金額",-1)),n("p",ge,[e[5]||(e[5]=n("span",{class:"mr-1"},"NT$",-1)),n("span",_e,i(u.value.paymentAmount),1)])]),n("div",he,[t($,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular text-white",color:"light-green-darken-2",disabled:u.value.ischeck!==0,height:"60","min-width":"200",variant:"flat",onClick:X},{default:l(()=>[y(" 折抵 "+i(f.value.c)+" 小時 ",1)]),_:1},8,["disabled"])]),n("div",ye,[t($,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",color:"orange-darken-2",disabled:!E.value,height:"60","min-width":"200",variant:"flat",onClick:K},{default:l(()=>[...e[7]||(e[7]=[y(" 線上繳費 ",-1)])]),_:1},8,["disabled"])]),_.value.length>0?(h(),le(R,{key:0,class:"my-5 pa-3 rounded-lg bg-grey-lighten-4 w-100",variant:"flat"},{default:l(()=>[t(D,{dense:""},{default:l(()=>[(h(!0),b(T,null,se(_.value,(a,d)=>(h(),b(T,{key:d},[t(U,{class:"text-grey-darken-1",cols:"8"},{default:l(()=>[y(i(a.vendor_name),1)]),_:2},1024),t(U,{class:"text-grey-darken-1",cols:"4"},{default:l(()=>[y(i(a.store_type===2?"$":"")+" "+i(a.amount)+" "+i(a.store_type===1||a.store_type===5?"hr":""),1)]),_:2},1024)],64))),128))]),_:1})]),_:1})):F("",!0)])):F("",!0)])]),_:1})]),_:1}),t(r,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),"is-confirm-btn":p.value,message:m.value,"message-title":w.value,onOnClose:S,onPromptConfirm:O},null,8,["modelValue","is-confirm-btn","message","message-title"])]),_:1})])}}}),Re=ue(xe,[["__scopeId","data-v-9e199920"]]);export{Re as default};
