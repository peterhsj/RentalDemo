import{h as l,y as q,ac as F,n as e,ad as o,a5 as u,ag as j,ah as D,a7 as I,v as c,x as z,u as M,V as O,a2 as A,Z as w}from"./vue-core-CsbKmrRr.js";import{a as E}from"./index-BFZgDbVB.js";import{_ as J,C as P}from"./CommonOverlay-DagrWHVy.js";import{_ as Q}from"./PromptDialog-TYGxE2y4.js";import"./index-B3zkBngv.js";import"./vuetify-CHkSyw28.js";import"./date-DE_Uv9Lq.js";const X={id:"login",class:"pa-5 mx-auto h-100 rental rental__wrapper"},Z={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},G={style:{width:"120px",height:"40px"}},H={class:"d-flex ga-2 flex-wrap justify-end w-100"},se={__name:"LoginView",setup(K){const U="https://peterhsj.github.io/RentalDemo",B=j(),C=D(),m=l(!1),y=l(""),V=l(""),R=l(!1),v=l({CounterLogin:{title:"住宿車輛登記",bgColor:"bg-grey-lighten-2",icon:"/images/bed.svg"},ShopLogin:{title:"商店消費折抵",bgColor:"bg-orange-lighten-5",icon:"/images/shoppingCart.svg"}}),f=l(!1),i=l(""),k=l(),s=l({account:"",password:"",captcha:""}),g=l({accountRules:[a=>!!a||"帳號為必填"],passwordRules:[a=>!!a||"密碼為必填"],captchaRules:[a=>!!a||"驗證碼為必填",a=>a===S.value||"請輸入有效的驗證碼"]});q(()=>B.path,a=>{i.value=a.slice(1)},{immediate:!0});const S=l(""),$=a=>{S.value=a},L=async()=>{const{valid:a}=await k.value.validate();if(!a)return;const{account:t,password:_}=s.value,p={account:t,password:_};f.value=!0;const n="/member/grand_hotel/login?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const d=await E.post(n,p),{returnCode:h,message:b,data:x}=d;if(h===0){if(localStorage.setItem("memberInfo",JSON.stringify(x)),i.value==="CounterLogin"){C.push("/Counter");return}if(i.value==="ShopLogin"){C.push("/Shop");return}}else{y.value="登入失敗",V.value=`<span class="text-body-2">${b}</span>`,R.value=!1,m.value=!0;return}}catch(d){console.log({err:d})}finally{f.value=!1}},N=()=>{m.value=!1};return(a,t)=>{const _=u("v-img"),p=u("v-text-field"),n=u("v-col"),d=u("v-row"),h=u("v-btn"),b=u("v-container"),x=u("v-form"),T=u("v-card");return I(),F("div",X,[e(T,{variant:"outlined",class:"rounded-lg bordered border-md bg-white h-100"},{default:o(()=>[c("div",{class:z(["px-4 py-3 d-flex align-center",v.value[i.value].bgColor])},[c("span",null,[e(_,{height:"40",width:"45",src:`${M(U)}${v.value[i.value].icon}`,cover:"",alt:"icon"},null,8,["src"])]),c("span",Z,O(v.value[i.value].title),1)],2),e(x,{ref_key:"loginFormRef",ref:k,class:"h-100",onSubmit:A(L,["prevent"])},{default:o(()=>[e(b,{class:"pb-2 d-flex flex-column justify-space-between",style:{height:"calc(100% - 64px)"}},{default:o(()=>[e(d,{dense:"",class:"flex-0-1"},{default:o(()=>[e(n,{cols:"12",md:"6"},{default:o(()=>[e(p,{modelValue:s.value.account,"onUpdate:modelValue":t[0]||(t[0]=r=>s.value.account=r),placeholder:"請輸入帳號",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:g.value.accountRules,required:""},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"6"},{default:o(()=>[e(p,{modelValue:s.value.password,"onUpdate:modelValue":t[1]||(t[1]=r=>s.value.password=r),placeholder:"請輸入密碼",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:g.value.passwordRules,required:""},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",class:"py-0"},{default:o(()=>[...t[5]||(t[5]=[c("p",{class:"text-subtitle-1 font-weight-bold"},"驗證碼",-1)])]),_:1}),e(n,{cols:"12",md:"6"},{default:o(()=>[e(p,{modelValue:s.value.captcha,"onUpdate:modelValue":t[2]||(t[2]=r=>s.value.captcha=r),placeholder:"請輸入驗證碼",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:g.value.captchaRules,onInput:t[3]||(t[3]=r=>s.value.captcha=s.value.captcha.toUpperCase()),required:""},{append:o(()=>[c("div",G,[e(P,{onSetCaptchaCode:$})])]),_:1},8,["modelValue","rules"])]),_:1}),e(n,{cols:"12"},{default:o(()=>[...t[6]||(t[6]=[c("p",{class:"text-subtitle-2 text-red-darken-1"},[w(" 注意："),c("br"),w(" 更換車號請重新操作，入場當日無法更換登記車號。 ")],-1)])]),_:1})]),_:1}),e(d,{"no-gutters":"",class:"flex-0-1"},{default:o(()=>[e(n,{cols:"12",class:"mt-4"},{default:o(()=>[c("div",H,[e(h,{type:"submit",color:"light-green-darken-2",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40"},{default:o(()=>[...t[7]||(t[7]=[w(" 登入 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),e(J,{overlay:f.value},null,8,["overlay"]),e(Q,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=r=>m.value=r),message:V.value,messageTitle:y.value,isConfirmBtn:R.value,onOnClose:N},null,8,["modelValue","message","messageTitle","isConfirmBtn"])])}}};export{se as default};
