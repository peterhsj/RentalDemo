import{h as l,y as F,ac as I,n as a,ad as o,a5 as i,ag as j,ah as D,a7 as z,v as c,x as M,u as O,V as P,a2 as A,Z as V}from"./vue-core-CsbKmrRr.js";import{a as E}from"./index-BFZgDbVB.js";import{_ as J,C as Q}from"./CommonOverlay-CuurJeUc.js";import{_ as X}from"./PromptDialog-TYGxE2y4.js";import"./index-CC_6urh-.js";import"./vuetify-CHkSyw28.js";import"./date-DE_Uv9Lq.js";const Z={id:"login",class:"pa-5 mx-auto h-100 rental rental__wrapper"},G={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},H={style:{width:"120px",height:"40px"}},K={class:"d-flex ga-2 flex-wrap justify-end w-100"},ne={__name:"LoginView",setup(W){const q="https://peterhsj.github.io/RentalDemo",U=j(),g=D(),m=l(!1),R=l(""),B=l(""),S=l(!1),_=l({CounterLogin:{title:"住宿車輛登記 - 登入",bgColor:"bg-grey-lighten-2",icon:"/images/bed.svg"},ShopLogin:{title:"商店消費折抵 - 登入",bgColor:"bg-orange-lighten-5",icon:"/images/shoppingCart.svg"},BanquetLogin:{title:"宴會廳消費折抵 - 登入",bgColor:"rental__bg--light-orange",icon:"/images/scanner.svg"}}),h=l(!1),s=l(""),k=l(),n=l({account:"",password:"",captcha:""}),b=l({accountRules:[t=>!!t||"帳號為必填"],passwordRules:[t=>!!t||"密碼為必填"],captchaRules:[t=>!!t||"驗證碼為必填",t=>t===L.value||"請輸入有效的驗證碼"]}),v=l(!1);F(()=>U.path,t=>{s.value=t.slice(1)},{immediate:!0});const L=l(""),$=t=>{L.value=t},T=async()=>{const{valid:t}=await k.value.validate();if(!t)return;let e=null;s.value==="CounterLogin"&&(e=4),s.value==="ShopLogin"&&(e=1),s.value==="BanquetLogin"&&(e=5);const{account:w,password:d}=n.value,u={store_type:e,account:w,password:d};h.value=!0;const f="/member/grand_hotel/login?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const p=await E.post(f,u),{returnCode:y,message:x,data:C}=p;if(y===0){if(localStorage.setItem("memberInfo",JSON.stringify(C)),s.value==="CounterLogin"){g.push("/Counter");return}if(s.value==="ShopLogin"){g.push("/Shop");return}if(s.value==="BanquetLogin"){g.push("/Banquet");return}}else{R.value="登入失敗",B.value=`<span class="text-body-2">${x}</span>`,S.value=!1,m.value=!0;return}}catch(p){console.log({err:p})}finally{h.value=!1}},N=()=>{m.value=!1};return(t,e)=>{const w=i("v-img"),d=i("v-text-field"),u=i("v-col"),f=i("v-row"),p=i("v-btn"),y=i("v-container"),x=i("v-form"),C=i("v-card");return z(),I("div",Z,[a(C,{variant:"outlined",class:"rounded-lg bordered border-md bg-white h-100"},{default:o(()=>[c("div",{class:M(["px-4 py-3 d-flex align-center",_.value[s.value].bgColor])},[c("span",null,[a(w,{height:"40",width:"45",src:`${O(q)}${_.value[s.value].icon}`,cover:"",alt:"icon"},null,8,["src"])]),c("span",G,P(_.value[s.value].title),1)],2),a(x,{ref_key:"loginFormRef",ref:k,class:"h-100",onSubmit:A(T,["prevent"])},{default:o(()=>[a(y,{class:"pb-2 d-flex flex-column justify-space-between",style:{height:"calc(100% - 64px)"}},{default:o(()=>[a(f,{dense:"",class:"flex-0-1"},{default:o(()=>[a(u,{cols:"12",md:"6"},{default:o(()=>[a(d,{modelValue:n.value.account,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value.account=r),placeholder:"請輸入帳號",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:b.value.accountRules,required:""},null,8,["modelValue","rules"])]),_:1}),a(u,{cols:"12",md:"6"},{default:o(()=>[a(d,{modelValue:n.value.password,"onUpdate:modelValue":e[1]||(e[1]=r=>n.value.password=r),placeholder:"請輸入密碼",type:v.value?"text":"password","append-inner-icon":v.value?"fa:far fa-eye-slash":"fa:far fa-eye","onClick:appendInner":e[2]||(e[2]=r=>v.value=!v.value),autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:b.value.passwordRules,required:""},null,8,["modelValue","type","append-inner-icon","rules"])]),_:1}),a(u,{cols:"12",class:"py-0"},{default:o(()=>[...e[6]||(e[6]=[c("p",{class:"text-subtitle-1 font-weight-bold"},"驗證碼",-1)])]),_:1}),a(u,{cols:"12",md:"6"},{default:o(()=>[a(d,{modelValue:n.value.captcha,"onUpdate:modelValue":e[3]||(e[3]=r=>n.value.captcha=r),placeholder:"請輸入驗證碼",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:b.value.captchaRules,onInput:e[4]||(e[4]=r=>n.value.captcha=n.value.captcha.toUpperCase()),required:""},{append:o(()=>[c("div",H,[a(Q,{onSetCaptchaCode:$})])]),_:1},8,["modelValue","rules"])]),_:1}),a(u,{cols:"12"},{default:o(()=>[...e[7]||(e[7]=[c("p",{class:"text-subtitle-2 text-red-darken-1"},[V(" 注意："),c("br"),V(" 更換車號請重新操作，入場當日無法更換登記車號。 ")],-1)])]),_:1})]),_:1}),a(f,{"no-gutters":"",class:"flex-0-1"},{default:o(()=>[a(u,{cols:"12",class:"mt-4"},{default:o(()=>[c("div",K,[a(p,{type:"submit",color:"light-green-darken-2",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40"},{default:o(()=>[...e[8]||(e[8]=[V(" 登入 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),a(J,{overlay:h.value},null,8,["overlay"]),a(X,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=r=>m.value=r),message:B.value,messageTitle:R.value,isConfirmBtn:S.value,onOnClose:N},null,8,["modelValue","message","messageTitle","isConfirmBtn"])])}}};export{ne as default};
