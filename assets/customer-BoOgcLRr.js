import{_ as J,a as P}from"./index-BQ43x7GY.js";import{l as K,ag as Z,ah as ee,H as ae,a3 as te,ad as b,aa as _,n as t,ab as l,v as n,u as F,Y as u,k as s,af as T,a0 as h,a9 as le,F as A,ae as se}from"./vue-core-BRXIlfIm.js";import{a as R,i as ne,d as D,j as oe,e as M,f as U,k as re,h as $}from"./index-KngcH0fI.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./date-ui-TtEhfnKH.js";import"./vuetify-ui-CxbL1ZWO.js";const ie={id:"banquet",class:"d-flex flex-column bg-grey-lighten-4 h-100"},ce={class:"px-4 py-3 d-flex align-center bg-orange-lighten-5"},de={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},fe={class:"h-100"},ve={key:0},me={class:"py-2 text-h5 font-weight-bold"},pe={class:"mt-5 d-flex flex-column align-center justify-center"},ge={class:"my-1"},_e={class:"text-h3 font-weight-bold"},he={class:"mt-3 d-flex flex-wrap justify-center w-100"},ye={class:"mt-3 d-flex flex-wrap justify-center w-100"},xe=K({__name:"customer",setup(we){const z="/RentalDemo/",L=Z(),k=ee(),j=s(!1);function C(o){try{const e=atob(o),r=Uint8Array.from(e,a=>a.codePointAt(0)??0);return new TextDecoder().decode(r)}catch(e){return console.error("Base64 解碼錯誤:",e),o}}const f=s({}),v=s({});function I(){f.value={c:k.query.c,v:k.query.v,vn:k.query.vn},f.value.c&&(v.value.c=Number(C(f.value.c))),f.value.v&&(v.value.v=Number(C(f.value.v))),f.value.vn&&(v.value.vn=C(f.value.vn))}const y=s(!1),i=s(!1),x=s(""),m=s(""),p=s(!1),q=s(null),g=s({license_plate:""}),E=s({carRules:[o=>!!o||"車號為必填",o=>!/[-]/.test(o)||"車號不需輸入 - 符號"]}),Q=s(!0),c=s(null),w=s([]);async function B(){c.value=null,w.value=[];const{valid:o}=await q.value?.validate()??{valid:!1};if(!o)return;const{license_plate:e}=g.value,r={license_plate:e};y.value=!0;const a="/member/grand_hotel/car_in_park_sel?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const d=await P.post(a,r),{returnCode:W,message:Y,data:N,discount:G}=d;W===0?(c.value=N,w.value=G,N.ischeck!==0&&(x.value="訊息通知",m.value=N.ischeck===1?`${e} 已進行住宿折抵，無法再折抵`:`${e} 折抵已到達上限，無法再折抵`,p.value=!1,i.value=!0)):(x.value="訊息通知",m.value=`${Y}`,p.value=!1,i.value=!0)}catch(d){console.log({err:d})}finally{y.value=!1}}async function X(){const o={license_plate:c.value?.license_plate,count:v.value.c,vendorId:v.value.v};y.value=!0;const e="/member/grand_hotel/register_qr?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const r=await P.post(e,o);console.log({res:r});const{returnCode:a,message:d}=r;a===0?(B(),m.value=`${d}`,p.value=!1,i.value=!0):(x.value="訊息通知",m.value=`${d}`,p.value=!1,i.value=!0)}catch(r){console.log({err:r})}finally{y.value=!1}}function H(){L.push("/Customer")}function O(){i.value=!1}function S(){i.value=!1}function V(){j.value=window.innerWidth<=960}return ae(()=>{V(),window.addEventListener("resize",V),I()}),te(()=>{window.removeEventListener("resize",V)}),(o,e)=>{const r=J;return _(),b("div",ie,[t(D,{id:"search",class:"rental rental__wrapper h-100",style:{"max-width":"600px"}},{default:l(()=>[t(R,{class:"rounded-lg bordered border-md bg-white h-100",variant:"outlined"},{default:l(()=>[n("div",ce,[t(ne,{image:`${F(z)}/images/check.svg`,size:"40"},null,8,["image"]),n("span",de,u(v.value.vn),1)]),t(D,{class:"pb-2 d-flex flex-column flex-grow-1 overflow-y-auto",style:{height:"calc(100% - 64px)"}},{default:l(()=>[n("div",fe,[t(F(oe),{ref_key:"searchFormRef",ref:q,class:"pt-4 py-1"},{default:l(()=>[t(M,{dense:""},{default:l(()=>[t(U,{cols:"12"},{default:l(()=>[t(re,{modelValue:g.value.license_plate,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value.license_plate=a),modelModifiers:{trim:!0},autocomplete:"off","bg-color":"white",class:"pr-0",color:"blue-darken-2",density:"compact",placeholder:"請輸入車號",required:"",rules:E.value.carRules,variant:"outlined",onInput:e[1]||(e[1]=a=>g.value.license_plate=g.value.license_plate.toUpperCase())},{"append-inner":l(()=>[t($,{class:"mr-n3 px-3",color:"blue-darken-3",height:"40",type:"button",variant:"flat",onClick:B},{default:l(()=>[...e[3]||(e[3]=[h(" 查詢 ",-1)])]),_:1})]),_:1},8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512),c.value?(_(),b("div",ve,[t(R,{class:"py-5 px-2 rounded-lg bg-blue-darken-3 text-center",variant:"flat"},{default:l(()=>[e[4]||(e[4]=n("p",{class:"py-2 text-h6 font-weight-regular"},"入場資訊",-1)),n("p",me,u(c.value.license_plate),1),n("p",null,u(c.value.arrival_time),1)]),_:1}),n("div",pe,[e[6]||(e[6]=n("p",{class:"my-4 text-h6"},"應繳金額",-1)),n("p",ge,[e[5]||(e[5]=n("span",{class:"mr-1"},"NT$",-1)),n("span",_e,u(c.value.paymentAmount),1)])]),n("div",he,[t($,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular text-white",color:"light-green-darken-2",disabled:c.value.ischeck!==0,height:"60","min-width":"200",variant:"flat",onClick:X},{default:l(()=>[h(" 折抵 "+u(v.value.c)+" 小時 ",1)]),_:1},8,["disabled"])]),n("div",ye,[t($,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",color:"orange-darken-2",disabled:!Q.value,height:"60","min-width":"200",variant:"flat",onClick:H},{default:l(()=>[...e[7]||(e[7]=[h(" 線上繳費 ",-1)])]),_:1},8,["disabled"])]),w.value.length>0?(_(),le(R,{key:0,class:"my-5 pa-3 rounded-lg bg-grey-lighten-4 w-100",variant:"flat"},{default:l(()=>[t(M,{dense:""},{default:l(()=>[(_(!0),b(A,null,se(w.value,(a,d)=>(_(),b(A,{key:d},[t(U,{class:"text-grey-darken-1",cols:"8"},{default:l(()=>[h(u(a.vendor_name),1)]),_:2},1024),t(U,{class:"text-grey-darken-1",cols:"4"},{default:l(()=>[h(u(a.store_type===2?"$":"")+" "+u(a.amount)+" "+u(a.store_type===1||a.store_type===5?"hr":""),1)]),_:2},1024)],64))),128))]),_:1})]),_:1})):T("",!0)])):T("",!0)])]),_:1})]),_:1}),t(r,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value=a),"is-confirm-btn":p.value,message:m.value,"message-title":x.value,onOnClose:S,onPromptConfirm:O},null,8,["modelValue","is-confirm-btn","message","message-title"])]),_:1})])}}}),Ue=ue(xe,[["__scopeId","data-v-f0d03dfe"]]);export{Ue as default};
