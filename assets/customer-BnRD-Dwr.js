import{_ as Y,a as P}from"./index-uTrXmuzQ.js";import{l as J,ah as K,H as Z,a3 as ee,ad as V,aa as h,n as t,ab as l,v as n,u as A,Y as c,k as s,af as D,a0 as y,a9 as ae,F,ae as te}from"./vue-core-BRXIlfIm.js";import{a as $,i as le,d as M,j as se,e as Q,f as N,k as ne,h as q}from"./index-kaIYYxbD.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./date-ui-TtEhfnKH.js";import"./vuetify-ui-CxbL1ZWO.js";const re={id:"banquet",class:"d-flex flex-column bg-grey-lighten-4 h-100"},ue={class:"px-4 py-3 d-flex align-center bg-orange-lighten-5"},ie={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},ce={class:"h-100"},de={key:0},ve={class:"py-2 text-h5 font-weight-bold"},fe={class:"mt-5 d-flex flex-column align-center justify-center"},me={class:"my-1"},pe={class:"text-h3 font-weight-bold"},ge={class:"mt-3 d-flex flex-wrap justify-center w-100"},_e={class:"mt-3 d-flex flex-wrap justify-center w-100"},he=J({__name:"customer",setup(ye){const T="/RentalDemo/",w=K(),I=s(!1);function x(o){try{const e=atob(o),i=Uint8Array.from(e,a=>a.codePointAt(0)??0);return new TextDecoder().decode(i)}catch(e){return console.error("Base64 解碼錯誤:",e),o}}const r=s({}),u=s({});function z(){r.value={c:w.query.c,v:w.query.v,u:w.query.u,vn:w.query.vn},r.value.c&&(u.value.c=Number(x(r.value.c))),r.value.v&&(u.value.v=Number(x(r.value.v))),r.value.u&&(u.value.u=Number(x(r.value.u))),r.value.vn&&(u.value.vn=x(r.value.vn))}const b=s(!1),d=s(!1),k=s(""),m=s(""),g=s(!1),U=s(null),p=s({license_plate:""}),E=s({carRules:[o=>!!o||"車號為必填",o=>!/[-]/.test(o)||"車號不需輸入 - 符號"]}),L=s(!0),v=s(null),C=s([]);async function B(){v.value=null,C.value=[];const{valid:o}=await U.value?.validate()??{valid:!1};if(!o)return;const{license_plate:e}=p.value,i={license_plate:e};b.value=!0;const a="/member/grand_hotel/car_in_park_sel?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const f=await P.post(a,i),{returnCode:X,message:H,data:_,discount:W}=f;X===0?(v.value=_,C.value=W,_.isQRcheck!==0&&(_.isQRcheck===1&&(m.value=`${e} 已進行住宿折抵，無法再次折抵`),_.isQRcheck===2&&(m.value=`${e} 已進行宴會廳折抵，無法再次折抵`),_.isQRcheck===3&&(m.value=`${e} 折抵時數已達當次上限`),k.value="訊息通知",g.value=!1,d.value=!0)):(k.value="訊息通知",m.value=`${H}`,g.value=!1,d.value=!0)}catch(f){console.log({err:f})}finally{b.value=!1}}async function j(){const o={license_plate:v.value?.license_plate,count:u.value.c,vendorId:u.value.v,userId:u.value.u};b.value=!0;const e="/member/grand_hotel/register_qr?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const i=await P.post(e,o),{returnCode:a,message:f}=i;a===0?(B(),m.value=`${f}`,g.value=!1,d.value=!0):(k.value="訊息通知",m.value=`${f}`,g.value=!1,d.value=!0)}catch(i){console.log({err:i})}finally{b.value=!1}}function G(){window.open(`https://rental.mitwit-cre.com.tw/service/payment/GE1AS9DOE3MG4I/bill/${p.value.license_plate}`,"_blank")}function O(){d.value=!1}function S(){d.value=!1}function R(){I.value=window.innerWidth<=960}return Z(()=>{R(),window.addEventListener("resize",R),z()}),ee(()=>{window.removeEventListener("resize",R)}),(o,e)=>{const i=Y;return h(),V("div",re,[t(M,{id:"search",class:"rental rental__wrapper h-100",style:{"max-width":"600px"}},{default:l(()=>[t($,{class:"rounded-lg bordered border-md bg-white h-100",variant:"outlined"},{default:l(()=>[n("div",ue,[t(le,{image:`${A(T)}/images/check.svg`,size:"40"},null,8,["image"]),n("span",ie,c(u.value.vn),1)]),t(M,{class:"pb-2 d-flex flex-column flex-grow-1 overflow-y-auto",style:{height:"calc(100% - 64px)"}},{default:l(()=>[n("div",ce,[t(A(se),{ref_key:"searchFormRef",ref:U,class:"pt-4 py-1"},{default:l(()=>[t(Q,{dense:""},{default:l(()=>[t(N,{cols:"12"},{default:l(()=>[t(ne,{modelValue:p.value.license_plate,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value.license_plate=a),modelModifiers:{trim:!0},autocomplete:"off","bg-color":"white",class:"pr-0",color:"blue-darken-2",density:"compact",placeholder:"請輸入車號",required:"",rules:E.value.carRules,variant:"outlined",onInput:e[1]||(e[1]=a=>p.value.license_plate=p.value.license_plate.toUpperCase())},{"append-inner":l(()=>[t(q,{class:"mr-n3 px-3",color:"blue-darken-3",height:"40",type:"button",variant:"flat",onClick:B},{default:l(()=>[...e[3]||(e[3]=[y(" 查詢 ",-1)])]),_:1})]),_:1},8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512),v.value?(h(),V("div",de,[t($,{class:"py-5 px-2 rounded-lg bg-blue-darken-3 text-center",variant:"flat"},{default:l(()=>[e[4]||(e[4]=n("p",{class:"py-2 text-h6 font-weight-regular"},"入場資訊",-1)),n("p",ve,c(v.value.license_plate),1),n("p",null,c(v.value.arrival_time),1)]),_:1}),n("div",fe,[e[6]||(e[6]=n("p",{class:"my-4 text-h6"},"應繳金額",-1)),n("p",me,[e[5]||(e[5]=n("span",{class:"mr-1"},"NT$",-1)),n("span",pe,c(v.value.paymentAmount),1)])]),n("div",ge,[t(q,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular text-white",color:"light-green-darken-2",disabled:v.value.ischeck===3,height:"60","min-width":"200",variant:"flat",onClick:j},{default:l(()=>[y(" 折抵 "+c(u.value.c)+" 小時 ",1)]),_:1},8,["disabled"])]),n("div",_e,[t(q,{class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",color:"orange-darken-2",disabled:!L.value,height:"60","min-width":"200",variant:"flat",onClick:G},{default:l(()=>[...e[7]||(e[7]=[y(" 線上繳費 ",-1)])]),_:1},8,["disabled"])]),C.value.length>0?(h(),ae($,{key:0,class:"my-5 pa-3 rounded-lg bg-grey-lighten-4 w-100",variant:"flat"},{default:l(()=>[t(Q,{dense:""},{default:l(()=>[(h(!0),V(F,null,te(C.value,(a,f)=>(h(),V(F,{key:f},[t(N,{class:"text-grey-darken-1",cols:"8"},{default:l(()=>[y(c(a.vendor_name),1)]),_:2},1024),t(N,{class:"text-grey-darken-1",cols:"4"},{default:l(()=>[y(c(a.store_type===2?"$":"")+" "+c(a.amount)+" "+c(a.store_type===1||a.store_type===5?"hr":""),1)]),_:2},1024)],64))),128))]),_:1})]),_:1})):D("",!0)])):D("",!0)])]),_:1})]),_:1}),t(i,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),"is-confirm-btn":g.value,message:m.value,"message-title":k.value,onOnClose:S,onPromptConfirm:O},null,8,["modelValue","is-confirm-btn","message","message-title"])]),_:1})])}}}),Re=oe(he,[["__scopeId","data-v-575da005"]]);export{Re as default};
