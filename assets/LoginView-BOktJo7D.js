import{h as l,y as F,ac as I,n as a,ad as o,a5 as u,ag as j,ah as D,a7 as z,v as i,x as M,u as O,V as P,a2 as A,Z as C}from"./vue-core-CsbKmrRr.js";import{a as E}from"./index-BFZgDbVB.js";import{_ as J,C as Q}from"./CommonOverlay-2qp08yOV.js";import{_ as X}from"./PromptDialog-TYGxE2y4.js";import"./index-X6-KuZg2.js";import"./vuetify-CHkSyw28.js";import"./date-DE_Uv9Lq.js";const Z={id:"login",class:"pa-5 mx-auto h-100 rental rental__wrapper"},G={class:"ml-3 text-h6 font-weight-bold text-grey-darken-2"},H={style:{width:"120px",height:"40px"}},K={class:"d-flex ga-2 flex-wrap justify-end w-100"},ne={__name:"LoginView",setup(W){const U="https://peterhsj.github.io/RentalDemo",q=j(),f=D(),m=l(!1),V=l(""),R=l(""),k=l(!1),g=l({CounterLogin:{title:"住宿車輛登記 - 登入",bgColor:"bg-grey-lighten-2",icon:"/images/bed.svg"},ShopLogin:{title:"商店消費折抵 - 登入",bgColor:"bg-orange-lighten-5",icon:"/images/shoppingCart.svg"},BanquetLogin:{title:"宴會廳消費折抵 - 登入",bgColor:"rental__bg--light-orange",icon:"/images/scanner.svg"}}),_=l(!1),c=l(""),B=l(),s=l({account:"",password:"",captcha:""}),h=l({accountRules:[t=>!!t||"帳號為必填"],passwordRules:[t=>!!t||"密碼為必填"],captchaRules:[t=>!!t||"驗證碼為必填",t=>t===S.value||"請輸入有效的驗證碼"]}),v=l(!1);F(()=>q.path,t=>{c.value=t.slice(1)},{immediate:!0});const S=l(""),L=t=>{S.value=t},$=async()=>{const{valid:t}=await B.value.validate();if(!t)return;const{account:e,password:b}=s.value,p={account:e,password:b};_.value=!0;const r="/member/grand_hotel/login?bQz0fX8f=4ApR34x2wb2CVTNUfsq3";try{const d=await E.post(r,p),{returnCode:w,message:x,data:y}=d;if(w===0){if(localStorage.setItem("memberInfo",JSON.stringify(y)),c.value==="CounterLogin"){f.push("/Counter");return}if(c.value==="ShopLogin"){f.push("/Shop");return}if(c.value==="BanquetLogin"){f.push("/Banquet");return}}else{V.value="登入失敗",R.value=`<span class="text-body-2">${x}</span>`,k.value=!1,m.value=!0;return}}catch(d){console.log({err:d})}finally{_.value=!1}},N=()=>{m.value=!1};return(t,e)=>{const b=u("v-img"),p=u("v-text-field"),r=u("v-col"),d=u("v-row"),w=u("v-btn"),x=u("v-container"),y=u("v-form"),T=u("v-card");return z(),I("div",Z,[a(T,{variant:"outlined",class:"rounded-lg bordered border-md bg-white h-100"},{default:o(()=>[i("div",{class:M(["px-4 py-3 d-flex align-center",g.value[c.value].bgColor])},[i("span",null,[a(b,{height:"40",width:"45",src:`${O(U)}${g.value[c.value].icon}`,cover:"",alt:"icon"},null,8,["src"])]),i("span",G,P(g.value[c.value].title),1)],2),a(y,{ref_key:"loginFormRef",ref:B,class:"h-100",onSubmit:A($,["prevent"])},{default:o(()=>[a(x,{class:"pb-2 d-flex flex-column justify-space-between",style:{height:"calc(100% - 64px)"}},{default:o(()=>[a(d,{dense:"",class:"flex-0-1"},{default:o(()=>[a(r,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:s.value.account,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value.account=n),placeholder:"請輸入帳號",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:h.value.accountRules,required:""},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:s.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>s.value.password=n),placeholder:"請輸入密碼",type:v.value?"text":"password","append-inner-icon":v.value?"fa:far fa-eye-slash":"fa:far fa-eye","onClick:appendInner":e[2]||(e[2]=n=>v.value=!v.value),autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:h.value.passwordRules,required:""},null,8,["modelValue","type","append-inner-icon","rules"])]),_:1}),a(r,{cols:"12",class:"py-0"},{default:o(()=>[...e[6]||(e[6]=[i("p",{class:"text-subtitle-1 font-weight-bold"},"驗證碼",-1)])]),_:1}),a(r,{cols:"12",md:"6"},{default:o(()=>[a(p,{modelValue:s.value.captcha,"onUpdate:modelValue":e[3]||(e[3]=n=>s.value.captcha=n),placeholder:"請輸入驗證碼",autocomplete:"off",variant:"outlined",density:"compact",color:"blue-darken-2",rules:h.value.captchaRules,onInput:e[4]||(e[4]=n=>s.value.captcha=s.value.captcha.toUpperCase()),required:""},{append:o(()=>[i("div",H,[a(Q,{onSetCaptchaCode:L})])]),_:1},8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[...e[7]||(e[7]=[i("p",{class:"text-subtitle-2 text-red-darken-1"},[C(" 注意："),i("br"),C(" 更換車號請重新操作，入場當日無法更換登記車號。 ")],-1)])]),_:1})]),_:1}),a(d,{"no-gutters":"",class:"flex-0-1"},{default:o(()=>[a(r,{cols:"12",class:"mt-4"},{default:o(()=>[i("div",K,[a(w,{type:"submit",color:"light-green-darken-2",variant:"flat",class:"my-2 px-8 w-100 w-sm-auto rounded-lg text-h6 font-weight-regular",height:"40"},{default:o(()=>[...e[8]||(e[8]=[C(" 登入 ",-1)])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),a(J,{overlay:_.value},null,8,["overlay"]),a(X,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=n=>m.value=n),message:R.value,messageTitle:V.value,isConfirmBtn:k.value,onOnClose:N},null,8,["modelValue","message","messageTitle","isConfirmBtn"])])}}};export{ne as default};
